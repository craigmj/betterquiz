#  lateral makeup header : Makefile Makefile-esbuild generated by 'lateral esbuild makefile'.
SHELL := /bin/bash
.ONESHELL:
.SHELLFLAGS := -eu -o pipefail -c
.DELETE_ON_ERROR:
MAKEFLAGS += --warn-undefined-variables
MAKEFLAGS += --no-builtin-rules

ifeq ($(origin .RECIPEPREFIX), undefined)
  $(error This Make does not support .RECIPEPREFIX. Please use GNU Make 4.0 or later)
endif
.RECIPEPREFIX = >

NODEVER=18.12.1

all: bqinstall 


bqinstall: ../../public/js/BQInstall.js
../../public/js/BQInstall.js: $(shell find . -type f -name '*.js')	
> ./node_modules/.bin/esbuild ./BQInstall.js --outfile=../../public/js/BQInstall.es6.js --bundle --sourcemap --target=es2017 --loader:.svg=text
> PATH="$(shell realpath node-v$(NODEVER)-linux-x64/bin):/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/usr/local/sbin";
> ./node-v$(NODEVER)-linux-x64/bin/npx swc ../../public/js/BQInstall.es6.js -o ../../public/js/BQInstall.js
> ./node-v$(NODEVER)-linux-x64/bin/npx swc -C minify=true -C jsc.minify.mangle=true ../../public/js/BQInstall.es6.js -o ../../public/js/BQInstall.min.js

	
./InstallTemplates.js: $(shell find . -type f -regextype posix-egrep -regex ".+\.(scss|css|html)$$")
> dtemplate -dir . -lang js -name "InstallTemplates" -out ./InstallTemplates.js -separator '/'



.PHONY: install
install:
> if [[ ! -f node-v$(NODEVER)-linux-x64/bin/node ]]; then
>	if [[ ! -f node-v$(NODEVER)-linux-x64.tar.xz ]]; then
>		curl -O https://nodejs.org/dist/v$(NODEVER)/node-v$(NODEVER)-linux-x64.tar.xz;
>	fi;
>	tar -xf node-v$(NODEVER)-linux-x64.tar.xz;
> fi
> if [[ ! -f package.json ]]; then
>	echo '{}' > package.json;
> fi
> PATH="$(shell realpath node-v$(NODEVER)-linux-x64/bin):/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/usr/local/sbin"; 
>	./node-v$(NODEVER)-linux-x64/bin/npm install esbuild --save-dev;
>	./node-v$(NODEVER)-linux-x64/bin/npm i -D @swc/cli @swc/core --save-dev

.PHONY: watch unwatch
watch:
> watchman watch $(shell realpath .)
> watchman -j <<< '["trigger", "$(shell realpath .)", { "name": "$(shell realpath .)_js", "expression": ["pcre", ".+\\.(js|scss|css|html)"], "command": ["lateral","run-notify","--","make", "-f","Makefile-esbuild", "bqinstall"], "chdir": "$(shell realpath .)" } ]'
	

unwatch:
> watchman trigger-del "$(shell realpath .)" "$(shell realpath .)_js"

